# secret_share_threshold_benchmark.c ä»£ç åˆ†æ

## ğŸ“‹ ç¨‹åºæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**ç§˜å¯†åˆ†äº«é˜ˆå€¼æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·**ï¼Œç”¨äºæµ‹è¯•ä¸åŒé˜ˆå€¼ï¼ˆthresholdï¼‰ä¸‹æ¤­åœ†æ›²çº¿ Feldman VSSï¼ˆå¯éªŒè¯ç§˜å¯†åˆ†äº«ï¼‰çš„æ€§èƒ½è¡¨ç°ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. æ€§èƒ½æµ‹è¯•ç›®æ ‡

æµ‹è¯•**é˜ˆå€¼å‚æ•°**å¯¹ç§˜å¯†åˆ†äº«ç³»ç»Ÿæ€§èƒ½çš„å½±å“ï¼š
- **åˆ†ç‰‡ç”Ÿæˆæ—¶é—´**ï¼šç”Ÿæˆç§˜å¯†åˆ†ç‰‡æ‰€éœ€çš„æ—¶é—´
- **æ‰¿è¯ºç”Ÿæˆæ—¶é—´**ï¼šç”Ÿæˆ VSS æ‰¿è¯ºæ‰€éœ€çš„æ—¶é—´
- **æ€»æ—¶é—´**ï¼šåˆ†ç‰‡ç”Ÿæˆ + æ‰¿è¯ºç”Ÿæˆçš„æ€»æ—¶é—´
- **æˆåŠŸç‡**ï¼šæ“ä½œæˆåŠŸçš„æ¯”ä¾‹

### 2. æµ‹è¯•é…ç½®

```c
#define BENCHMARK_RUNS 100              // æ¯ä¸ªé˜ˆå€¼æµ‹è¯•100æ¬¡
#define FIXED_MESSAGE_SIZE 15767        // å›ºå®šæ¶ˆæ¯å¤§å°ï¼š15767å­—èŠ‚
#define FIXED_COMMITTEE_SIZE 20        // å›ºå®šå§”å‘˜ä¼šå¤§å°ï¼š20ä¸ªæˆå‘˜
#define MIN_THRESHOLD 2                 // æœ€å°é˜ˆå€¼ï¼š2
#define MAX_THRESHOLD 19                // æœ€å¤§é˜ˆå€¼ï¼š19
```

**æµ‹è¯•èŒƒå›´**ï¼šé˜ˆå€¼ä» 2 åˆ° 19ï¼Œæ¯ä¸ªé˜ˆå€¼æµ‹è¯• 100 æ¬¡ï¼Œå…± 18 ä¸ªé˜ˆå€¼ Ã— 100 æ¬¡ = 1800 æ¬¡æµ‹è¯•ã€‚

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### æ¨¡å—1ï¼šåŠ¨æ€é˜ˆå€¼åˆ†ç‰‡ç”Ÿæˆ

#### `create_secret_shares_dynamic_threshold()`

**åŠŸèƒ½**ï¼šåŸºäºæ¤­åœ†æ›²çº¿ Feldman VSS ç”Ÿæˆç§˜å¯†åˆ†ç‰‡ï¼Œæ”¯æŒåŠ¨æ€é˜ˆå€¼ã€‚

**ç®—æ³•æµç¨‹**ï¼š

1. **åˆ†å—å¤„ç†**ï¼š
   ```c
   size_t num_blocks = (secret_len + BLOCK_SIZE - 1) / BLOCK_SIZE;
   ```
   - å°†å¤§æ¶ˆæ¯åˆ†æˆå¤šä¸ªå—ï¼ˆæ¯å— `BLOCK_SIZE` å­—èŠ‚ï¼‰
   - æ¯ä¸ªå—ç‹¬ç«‹è¿›è¡Œç§˜å¯†åˆ†äº«

2. **å¤šé¡¹å¼ç”Ÿæˆ**ï¼ˆå¯¹æ¯ä¸ªå—ï¼‰ï¼š
   - ç”Ÿæˆ `threshold` ä¸ªç³»æ•°çš„å¤šé¡¹å¼ï¼š`f(x) = aâ‚€ + aâ‚x + ... + a_{t-1}x^{t-1}`
   - å¸¸æ•°é¡¹ `aâ‚€` = å—çš„å€¼ï¼ˆç§˜å¯†ï¼‰
   - å…¶ä»–ç³»æ•° `aâ‚, ..., a_{t-1}` = éšæœºæ•°ï¼ˆåœ¨æ¤­åœ†æ›²çº¿é˜¶ä¸Šï¼‰

3. **åˆ†ç‰‡è®¡ç®—**ï¼ˆå¯¹æ¯ä¸ªå‚ä¸è€…ï¼‰ï¼š
   ```c
   // ä½¿ç”¨ Horner æ–¹æ³•è®¡ç®— f(x) = aâ‚€ + aâ‚x + ... + a_{t-1}x^{t-1} (mod order)
   for (int k = threshold - 1; k >= 0; k--) {
       bn_mul(share_value, share_value, x_bn);
       bn_mod(share_value, share_value, order);
       bn_add(share_value, share_value, coeffs[k]);
       bn_mod(share_value, share_value, order);
   }
   ```
   - `x = participant + 1`ï¼ˆå‚ä¸è€…ç¼–å·ä»1å¼€å§‹ï¼‰
   - è®¡ç®— `f(participant + 1)` ä½œä¸ºè¯¥å‚ä¸è€…çš„åˆ†ç‰‡å€¼

4. **ç³»æ•°ä¿å­˜**ï¼š
   ```c
   // ä¿å­˜ç³»æ•°ä»¥ä¾¿åç»­ç”Ÿæˆæ‰¿è¯º
   bn_copy(saved_coeffs_dynamic[block_idx][i], coeffs[i]);
   ```
   - ä¿å­˜æ‰€æœ‰å¤šé¡¹å¼ç³»æ•°ï¼Œç”¨äºåç»­ç”Ÿæˆ VSS æ‰¿è¯º

**å…³é”®ç‚¹**ï¼š
- âœ… æ”¯æŒåŠ¨æ€é˜ˆå€¼ï¼ˆå¯ä»¥æ”¹å˜é˜ˆå€¼å‚æ•°ï¼‰
- âœ… ä½¿ç”¨æ¤­åœ†æ›²çº¿é˜¶ä½œä¸ºæ¨¡æ•°ï¼ˆä¿è¯å®‰å…¨æ€§ï¼‰
- âœ… ä½¿ç”¨ Horner æ–¹æ³•ä¼˜åŒ–å¤šé¡¹å¼è®¡ç®—
- âœ… åˆ†å—å¤„ç†æ”¯æŒå¤§æ¶ˆæ¯

### æ¨¡å—2ï¼šåŠ¨æ€é˜ˆå€¼ VSS æ‰¿è¯ºç”Ÿæˆ

#### `create_vss_commitments_dynamic_threshold()`

**åŠŸèƒ½**ï¼šç”Ÿæˆ Feldman VSS æ‰¿è¯ºï¼Œç”¨äºéªŒè¯åˆ†ç‰‡çš„æ­£ç¡®æ€§ã€‚

**ç®—æ³•æµç¨‹**ï¼š

1. **éªŒè¯ç³»æ•°å·²ä¿å­˜**ï¼š
   ```c
   if (!coeffs_saved_dynamic || saved_num_blocks != num_blocks || saved_threshold != threshold) {
       // é”™è¯¯ï¼šå¿…é¡»å…ˆè°ƒç”¨ create_secret_shares_dynamic_threshold
   }
   ```

2. **ç”Ÿæˆ Feldman æ‰¿è¯º**ï¼ˆå¯¹æ¯ä¸ªå—çš„æ¯ä¸ªç³»æ•°ï¼‰ï¼š
   ```c
   // è®¡ç®— Feldman æ‰¿è¯ºï¼šC_i = g^(coeff_i)
   ec_mul_gen(temp_point, coeff_bn);
   ```
   - `g` = æ¤­åœ†æ›²çº¿ç”Ÿæˆå…ƒ
   - `C_i = g^(a_i)` = ç³»æ•° `a_i` çš„æ‰¿è¯º
   - æ‰¿è¯ºæ˜¯æ¤­åœ†æ›²çº¿ç‚¹ï¼ˆå‹ç¼©æ ¼å¼ï¼‰

3. **å­˜å‚¨æ‰¿è¯º**ï¼š
   ```c
   memcpy(commitment->commitments[block_idx][i], compressed, RLC_EC_SIZE_COMPRESSED);
   ```

**Feldman VSS æ‰¿è¯ºçš„ä½œç”¨**ï¼š
- âœ… **å¯éªŒè¯æ€§**ï¼šä»»ä½•å‚ä¸è€…éƒ½å¯ä»¥éªŒè¯æ”¶åˆ°çš„åˆ†ç‰‡æ˜¯å¦æ­£ç¡®
- âœ… **é˜²æ¬ºè¯ˆ**ï¼šé˜²æ­¢åˆ†å‘è€…åˆ†å‘é”™è¯¯çš„åˆ†ç‰‡
- âœ… **å…¬å¼€éªŒè¯**ï¼šæ‰¿è¯ºæ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥éªŒè¯

### æ¨¡å—3ï¼šæ€§èƒ½ç»Ÿè®¡

#### `benchmark_stats_t` ç»“æ„ä½“

```c
typedef struct {
    double min_time;      // æœ€å°æ—¶é—´
    double max_time;      // æœ€å¤§æ—¶é—´
    double avg_time;      // å¹³å‡æ—¶é—´
    double total_time;    // æ€»æ—¶é—´
    int success_count;    // æˆåŠŸæ¬¡æ•°
    int fail_count;       // å¤±è´¥æ¬¡æ•°
} benchmark_stats_t;
```

#### `update_stats()` å‡½æ•°

æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼š
- è®°å½•æ¯æ¬¡æµ‹è¯•çš„æ—¶é—´
- ç»Ÿè®¡æˆåŠŸ/å¤±è´¥æ¬¡æ•°
- è®¡ç®—æœ€å°ã€æœ€å¤§ã€å¹³å‡æ—¶é—´

#### `print_stats()` å‡½æ•°

æ‰“å°ç»Ÿè®¡ç»“æœï¼š
- æˆåŠŸ/å¤±è´¥æ¬¡æ•°
- æœ€å°/æœ€å¤§/å¹³å‡æ—¶é—´
- æˆåŠŸç‡

### æ¨¡å—4ï¼šä¸»æµ‹è¯•æµç¨‹

#### `benchmark_thresholds()` å‡½æ•°

**æµ‹è¯•æµç¨‹**ï¼š

```
å¯¹æ¯ä¸ªé˜ˆå€¼ threshold = 2 åˆ° 19:
    åˆå§‹åŒ–ç»Ÿè®¡ç»“æ„ï¼ˆåˆ†ç‰‡ã€æ‰¿è¯ºã€æ€»æ—¶é—´ï¼‰
    
    å¯¹æ¯æ¬¡è¿è¡Œ run = 1 åˆ° 100:
        1. ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®
        2. æµ‹è¯•åˆ†ç‰‡ç”Ÿæˆæ—¶é—´
        3. å¦‚æœæˆåŠŸï¼Œæµ‹è¯•æ‰¿è¯ºç”Ÿæˆæ—¶é—´
        4. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    
    æ‰“å°ç»Ÿè®¡ç»“æœ
    å†™å…¥CSVæ–‡ä»¶
```

**CSV è¾“å‡ºæ ¼å¼**ï¼š
```csv
CommitteeSize,Threshold,ShareTime,CommitmentTime,TotalTime,ShareSuccessRate,CommitmentSuccessRate
20,2,12.345,8.901,21.246,100.0,100.0
20,3,13.456,9.012,22.468,100.0,100.0
...
```

## ğŸ“Š æµ‹è¯•ç»“æœåˆ†æ

### é¢„æœŸæ€§èƒ½è¶‹åŠ¿

1. **é˜ˆå€¼å¯¹æ€§èƒ½çš„å½±å“**ï¼š
   - **é˜ˆå€¼è¶Šå¤§** â†’ å¤šé¡¹å¼ç³»æ•°è¶Šå¤š â†’ è®¡ç®—é‡è¶Šå¤§ â†’ **æ—¶é—´è¶Šé•¿**
   - **åˆ†ç‰‡ç”Ÿæˆ**ï¼šéœ€è¦è®¡ç®— `committee_size Ã— num_blocks` ä¸ªåˆ†ç‰‡å€¼
   - **æ‰¿è¯ºç”Ÿæˆ**ï¼šéœ€è¦è®¡ç®— `num_blocks Ã— threshold` ä¸ªæ¤­åœ†æ›²çº¿ç‚¹

2. **æ—¶é—´å¤æ‚åº¦**ï¼š
   - **åˆ†ç‰‡ç”Ÿæˆ**ï¼šO(committee_size Ã— num_blocks Ã— threshold)
   - **æ‰¿è¯ºç”Ÿæˆ**ï¼šO(num_blocks Ã— threshold)
   - **æ€»æ—¶é—´**ï¼šO(committee_size Ã— num_blocks Ã— threshold)

3. **ç©ºé—´å¤æ‚åº¦**ï¼š
   - **åˆ†ç‰‡æ•°ç»„**ï¼š`num_blocks Ã— committee_size` ä¸ªåˆ†ç‰‡
   - **ç³»æ•°ä¿å­˜**ï¼š`num_blocks Ã— threshold` ä¸ªå¤§æ•´æ•°
   - **æ‰¿è¯ºæ•°ç»„**ï¼š`num_blocks Ã— threshold` ä¸ªæ¤­åœ†æ›²çº¿ç‚¹

## ğŸ” å…³é”®æŠ€æœ¯ç»†èŠ‚

### 1. æ¤­åœ†æ›²çº¿å‚æ•°

```c
ec_param_set_any();      // è®¾ç½®æ¤­åœ†æ›²çº¿å‚æ•°
ep_param_set(SECG_K256); // ä½¿ç”¨ secp256k1 æ›²çº¿
```

- ä½¿ç”¨ **secp256k1** æ›²çº¿ï¼ˆä¸æ¯”ç‰¹å¸ç›¸åŒï¼‰
- æä¾› 256 ä½å®‰å…¨çº§åˆ«

### 2. åˆ†å—å¤„ç†

```c
size_t num_blocks = (secret_len + BLOCK_SIZE - 1) / BLOCK_SIZE;
```

- å¤§æ¶ˆæ¯è¢«åˆ†æˆå¤šä¸ªå—
- æ¯ä¸ªå—ç‹¬ç«‹è¿›è¡Œç§˜å¯†åˆ†äº«
- æ”¯æŒä»»æ„å¤§å°çš„æ¶ˆæ¯

### 3. Horner æ–¹æ³•ä¼˜åŒ–

```c
// ä½¿ç”¨ Horner æ–¹æ³•è®¡ç®—å¤šé¡¹å¼ï¼Œå‡å°‘ä¹˜æ³•æ¬¡æ•°
for (int k = threshold - 1; k >= 0; k--) {
    bn_mul(share_value, share_value, x_bn);
    bn_mod(share_value, share_value, order);
    bn_add(share_value, share_value, coeffs[k]);
    bn_mod(share_value, share_value, order);
}
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘ä¹˜æ³•è¿ç®—æ¬¡æ•°
- æé«˜è®¡ç®—æ•ˆç‡
- é™ä½æ•°å€¼è¯¯å·®

### 4. ç¡®å®šæ€§éšæœºç§å­

```c
unsigned int seed = 0;
for (size_t i = 0; i < secret_len && i < 4; i++) {
    seed = (seed << 8) | secret[i];
}
seed ^= (unsigned int)secret_len;
srand(seed);
```

- åŸºäºç§˜å¯†å†…å®¹ç”Ÿæˆç¡®å®šæ€§ç§å­
- ç¡®ä¿ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒéšæœºæ•°ï¼ˆç”¨äºæµ‹è¯•å¯é‡å¤æ€§ï¼‰

## ğŸ“ˆ è¾“å‡ºæ–‡ä»¶

### CSV æ–‡ä»¶ä½ç½®

```
/home/zxx/A2L/A2L-master/ecdsa/bin/fig_test/secret_share_threshold_benchmark.csv
```

### CSV æ ¼å¼

```csv
CommitteeSize,Threshold,ShareTime,CommitmentTime,TotalTime,ShareSuccessRate,CommitmentSuccessRate
20,2,12.345,8.901,21.246,100.0,100.0
20,3,13.456,9.012,22.468,100.0,100.0
...
```

**å­—æ®µè¯´æ˜**ï¼š
- `CommitteeSize`: å§”å‘˜ä¼šå¤§å°ï¼ˆå›ºå®šä¸º20ï¼‰
- `Threshold`: é˜ˆå€¼ï¼ˆ2-19ï¼‰
- `ShareTime`: åˆ†ç‰‡ç”Ÿæˆå¹³å‡æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `CommitmentTime`: æ‰¿è¯ºç”Ÿæˆå¹³å‡æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `TotalTime`: æ€»å¹³å‡æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `ShareSuccessRate`: åˆ†ç‰‡ç”ŸæˆæˆåŠŸç‡ï¼ˆ%ï¼‰
- `CommitmentSuccessRate`: æ‰¿è¯ºç”ŸæˆæˆåŠŸç‡ï¼ˆ%ï¼‰

## ğŸš€ è¿è¡Œæ–¹å¼

### ç¼–è¯‘

```bash
cd /home/zxx/A2L/A2L-master/ecdsa
mkdir -p build && cd build
cmake ..
make secret_share_threshold_benchmark
```

### è¿è¡Œ

```bash
./bin/secret_share_threshold_benchmark
```

### è¾“å‡º

1. **æ§åˆ¶å°è¾“å‡º**ï¼š
   - æ¯ä¸ªé˜ˆå€¼çš„è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
   - æˆåŠŸ/å¤±è´¥æ¬¡æ•°
   - æœ€å°/æœ€å¤§/å¹³å‡æ—¶é—´
   - æˆåŠŸç‡

2. **CSV æ–‡ä»¶**ï¼š
   - æ‰€æœ‰æµ‹è¯•ç»“æœæ±‡æ€»
   - å¯ç”¨äºç»˜åˆ¶æ€§èƒ½æ›²çº¿å›¾

## ğŸ¯ åº”ç”¨åœºæ™¯

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - äº†è§£ä¸åŒé˜ˆå€¼å¯¹æ€§èƒ½çš„å½±å“
   - é€‰æ‹©æœ€ä¼˜é˜ˆå€¼å‚æ•°

2. **ç³»ç»Ÿè®¾è®¡**ï¼š
   - è¯„ä¼°ç³»ç»Ÿåœ¨ä¸åŒé˜ˆå€¼ä¸‹çš„æ€§èƒ½
   - ç¡®å®šç³»ç»Ÿå®¹é‡å’Œå“åº”æ—¶é—´

3. **å­¦æœ¯ç ”ç©¶**ï¼š
   - åˆ†æ VSS ç®—æ³•çš„æ€§èƒ½ç‰¹å¾
   - æ¯”è¾ƒä¸åŒå®ç°æ–¹æ¡ˆçš„æ€§èƒ½

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**ï¼š
   - å¤§æ¶ˆæ¯ä¼šäº§ç”Ÿå¤§é‡åˆ†ç‰‡å’Œæ‰¿è¯º
   - æ³¨æ„å†…å­˜é™åˆ¶

2. **æµ‹è¯•æ—¶é—´**ï¼š
   - 1800 æ¬¡æµ‹è¯•å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
   - å»ºè®®åœ¨æ€§èƒ½è¾ƒå¥½çš„æœºå™¨ä¸Šè¿è¡Œ

3. **ç»“æœå¯é‡å¤æ€§**ï¼š
   - ä½¿ç”¨ç¡®å®šæ€§éšæœºç§å­
   - ä½†å®é™…è¿è¡Œæ—¶é—´å¯èƒ½å› ç³»ç»Ÿè´Ÿè½½è€Œå¼‚

## ğŸ“ æ€»ç»“

`secret_share_threshold_benchmark.c` æ˜¯ä¸€ä¸ª**ä¸“ä¸šçš„æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·**ï¼Œç”¨äºï¼š

1. âœ… **æµ‹è¯•ä¸åŒé˜ˆå€¼ä¸‹çš„æ€§èƒ½**ï¼šä»é˜ˆå€¼ 2 åˆ° 19
2. âœ… **æµ‹é‡åˆ†ç‰‡å’Œæ‰¿è¯ºç”Ÿæˆæ—¶é—´**ï¼šç²¾ç¡®åˆ°æ¯«ç§’
3. âœ… **ç»Ÿè®¡æˆåŠŸç‡å’Œæ€§èƒ½æŒ‡æ ‡**ï¼šæœ€å°/æœ€å¤§/å¹³å‡æ—¶é—´
4. âœ… **è¾“å‡º CSV æ ¼å¼ç»“æœ**ï¼šä¾¿äºåç»­åˆ†æå’Œå¯è§†åŒ–
5. âœ… **æ”¯æŒå¤§æ¶ˆæ¯åˆ†å—å¤„ç†**ï¼š15767 å­—èŠ‚çš„æ¶ˆæ¯
6. âœ… **ä½¿ç”¨æ¤­åœ†æ›²çº¿ Feldman VSS**ï¼šæä¾›å¯éªŒè¯æ€§

è¿™ä¸ªå·¥å…·å¯¹äº**ä¼˜åŒ–ç§˜å¯†åˆ†äº«ç³»ç»Ÿ**å’Œ**é€‰æ‹©æœ€ä¼˜é˜ˆå€¼å‚æ•°**éå¸¸æœ‰ä»·å€¼ã€‚



















