# (G, g, q) 参数详细解释

## 概述

`(G, g, q)` 是协议中的三个核心密码学参数，分别代表：
- **G**: 椭圆曲线群的生成元
- **g**: Class Group 的生成元
- **q**: 椭圆曲线群的阶（素数）

---

## 1. G - 椭圆曲线生成元

### 定义
**G** 是 secp256k1 椭圆曲线群的生成元（generator point）。

### 数学表示
- **曲线方程**: $y^2 = x^3 + 7 \pmod{p}$
- **生成元坐标**:
  - $G_x = \text{0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798}$
  - $G_y = \text{0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8}$
- **点表示**: $G = (G_x, G_y)$

### 代码实现
```c
// util.c:1432-1434
GEN Gx = strtoi("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798");
GEN Gy = strtoi("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8");
params->G = mkvecn(2, Gx, Gy);
```

### 用途
1. **椭圆曲线密钥生成**: 
   - 私钥 $sk \in \mathbb{Z}_q$
   - 公钥 $pk = sk \cdot G$（标量乘法）

2. **椭圆曲线签名**:
   - ECDSA 签名使用 $G$ 作为基点
   - 阈值签名中的部分签名计算

3. **椭圆曲线承诺**:
   - GS 承诺系统中的基点
   - VSS 承诺中的生成元

### 数学性质
- $G$ 是循环群的生成元，意味着群中所有点都可以表示为 $k \cdot G$（$k \in [0, q-1]$）
- 群的大小等于 $q$（群的阶）

---

## 2. g - Class Group 生成元

### 定义
**g** (在代码中表示为 `g_q`) 是 Class Group 的生成元。

### 数学表示
- **Class Group**: 基于二次型（quadratic form）的群
- **生成元**: $g_q = \text{Qfb}(a, b, c)$，其中：
  - $a = \text{4008431686288539256019978212352910132512184203702279780629385896624473051840259706993970111658701503889384191610389161437594619493081376284617693948914940268917628321033421857293703008209538182518138447355678944124861126384966287069011522892641935034510731734298233539616955610665280660839844718152071538201031396242932605390717004106131705164194877377}$
  - $b = \text{-3117991088204303366418764671444893060060110057237597977724832444027781815030207752301780903747954421114626007829980376204206959818582486516608623149988315386149565855935873517607629155593328578131723080853521348613293428202727746191856239174267496577422490575311784334114151776741040697808029563449966072264511544769861326483835581088191752567148165409}$
  - $c = \text{7226982982667784284607340011220616424554394853592495056851825214613723615410492468400146084481943091452495677425649405002137153382700126963171182913281089395393193450415031434185562111748472716618186256410737780813669746598943110785615647848722934493732187571819575328802273312361412673162473673367423560300753412593868713829574117975260110889575205719}$

### 代码实现
```c
// util.c:1417-1424
GEN g_q_a = strtoi("4008431686288539256019978212352910132512184203702279780629385896624473051840259706993970111658701503889384191610389161437594619493081376284617693948914940268917628321033421857293703008209538182518138447355678944124861126384966287069011522892641935034510731734298233539616955610665280660839844718152071538201031396242932605390717004106131705164194877377");
GEN g_q_b = negi(strtoi("3117991088204303366418764671444893060060110057237597977724832444027781815030207752301780903747954421114626007829980376204206959818582486516608623149988315386149565855935873517607629155593328578131723080853521348613293428202727746191856239174267496577422490575311784334114151776741040697808029563449966072264511544769861326483835581088191752567148165409"));
GEN g_q_c = strtoi("7226982982667784284607340011220616424554394853592495056851825214613723615410492468400146084481943091452495677425649405002137153382700126963171182913281089395393193450415031434185562111748472716618186256410737780813669746598943110785615647848722934493732187571819575328802273312361412673162473673367423560300753412593868713829574117975260110889575205719");

GEN g_q_temp = Qfb0(g_q_a, g_q_b, g_q_c);
params->g_q = qfbred(g_q_temp);  // 约化到标准形式
```

### 用途
1. **Class Group 加密**:
   - 加密: $c_1 = g_q^r$, $c_2 = m \cdot pk^r$
   - 其中 $r$ 是随机数，$pk$ 是公钥

2. **DKG 承诺**:
   - 在 DKG 协议中，承诺计算为: $A_{i,j} = g_q^{a_{i,j}}$
   - 其中 $a_{i,j}$ 是多项式系数

3. **零知识证明**:
   - 在 CLDL 证明中使用 Class Group 运算
   - 证明加密的正确性

### 数学性质
- Class Group 是基于判别式 $\Delta_K$ 的群
- 群运算使用二次型的组合（composition）
- 支持离散对数假设（Class Group DLP）

---

## 3. q - 椭圆曲线群的阶

### 定义
**q** 是 secp256k1 椭圆曲线群的阶（order），即群中元素的个数。

### 数学表示
$$q = 115792089237316195423570985008687907852837564279074904382605163141518161494337$$

这是一个 **256位素数**。

### 代码实现
```c
// util.c:1422
params->q = strtoi("115792089237316195423570985008687907852837564279074904382605163141518161494337");
```

### 用途
1. **模运算域**:
   - 所有私钥、签名值都在 $\mathbb{Z}_q$ 中
   - 标量乘法: $k \cdot G$ 其中 $k \in [0, q-1]$

2. **密钥生成**:
   - 私钥: $sk \leftarrow \mathbb{Z}_q$（随机选择）
   - 公钥: $pk = sk \cdot G$

3. **签名计算**:
   - ECDSA 签名: $s = k^{-1}(h + r \cdot sk) \bmod q$
   - 阈值签名中的 Lagrange 插值也在 $\mathbb{Z}_q$ 上进行

4. **Class Group 映射**:
   - Class Group 加密的明文空间也是 $\mathbb{Z}_q$
   - 加密: $c_2 = m \cdot pk^r$ 其中 $m \in \mathbb{Z}_q$

### 数学性质
- $q$ 是素数，所以 $\mathbb{Z}_q$ 是一个有限域
- $q \approx 2^{256}$，提供 128 位安全级别
- $q$ 也是 Class Group 运算中使用的模数

---

## 三者之间的关系

### 1. 椭圆曲线群 (G, q)
- **群**: $E(\mathbb{F}_p) = \{k \cdot G : k \in [0, q-1]\}$
- **生成元**: $G$
- **阶**: $q$
- **运算**: 椭圆曲线点加法和标量乘法

### 2. Class Group (g_q, q)
- **群**: Class Group 基于判别式 $\Delta_K$
- **生成元**: $g_q$
- **阶**: 与 $q$ 相关（用于映射）
- **运算**: 二次型的组合

### 3. 连接
- 两个群都使用相同的阶 $q$ 作为模数
- Class Group 加密的明文空间是 $\mathbb{Z}_q$
- 椭圆曲线签名和 Class Group 加密可以组合使用

---

## 在协议中的使用

### GlobalSetup 阶段
```c
// 1. 生成椭圆曲线参数
params->G = (Gx, Gy);  // 椭圆曲线生成元
params->q = 115792089237316195423570985008687907852837564279074904382605163141518161494337;

// 2. 生成 Class Group 参数
params->g_q = Qfb(a, b, c);  // Class Group 生成元
```

### 密钥生成
```c
// 椭圆曲线密钥
sk_EC ← Z_q
pk_EC = sk_EC · G

// Class Group 密钥
sk_CL ← Z_q
pk_CL = g_q^sk_CL
```

### DKG 协议
```c
// 承诺计算
A[i,j] = g_q^{a[i,j]}  // Class Group 运算

// 份额验证
g_q^{s[i,j]} ?= ∏ A[i,k]^{j^k}  // Class Group 验证
```

### 加密
```c
// Class Group 加密
c1 = g_q^r
c2 = m · pk^r  // m ∈ Z_q
```

---

## 总结

| 参数 | 类型 | 用途 | 数学结构 |
|------|------|------|----------|
| **G** | 椭圆曲线点 | 椭圆曲线群的生成元 | $G = (G_x, G_y) \in E(\mathbb{F}_p)$ |
| **g** (g_q) | Class Group 元素 | Class Group 的生成元 | $g_q = \text{Qfb}(a, b, c)$ |
| **q** | 大素数 | 椭圆曲线群的阶 | $q \approx 2^{256}$ |

这三个参数共同构成了协议的基础密码学结构：
- **G** 用于椭圆曲线密码学（签名、验证）
- **g** 用于 Class Group 密码学（加密、承诺）
- **q** 作为两个系统的共同模数，确保兼容性

